# 생두 가격 예측 모델 및 전략 개발
## 💡 프로젝트 소개
- 최근 커피 생두 가격의 높은 변동성으로 인해 관련 산업 리스크가 증대하고 있음. 또한 생두의 유통기한은 1년으로 수시로 필요한 양을 대량 구매해야하는 구조이므로 생두 단가가 낮을 때 많이 구매해 수익 극대화 하는 것이 중요함
- 생두 가격의 변동성이 크므로 원두 구매 시점에 따라 수익이 달라져 생두의 시장 타이밍이 수익 극대화의 핵심 요소임
- 다양한 요인을 반영한 시계열 예측 모델을 개발하여 짧은 유통기한을 가진 커피 원두의 구매 시점 인사이트를 제공하고자 함

### 🟦 프로젝트 기간
2025.03.06 - 2025.06.12

## 💡 Attention-LSTM 모델을 통한 생두 가격 예측
### 🟦 사용 데이터

#### 1. 거시경제 데이터

| 파생 변수명        | 설명                   |
| --------------- | ----------------------- |
| Coffee_Price_Return  | 일간 수익률 |
| Volatility_5d,Volatility_10d  | 최근 5/10일간 변동성 |
| momentum_1d,momentum_5d,momentum_10d,  | 최근 1,3,5일간 순가격 상승폭 |
| bollinger_width  | 상대 변동성|
| volatility_ratio | 단기/중기 변동성 비율 |

#### 2 기후 데이터
| 파생 변수명        | 설명                   |
| --------------- | ----------------------- |
| 재배지역명_PRECTOTCORR_harvest_mean | 재배지역별 비수확기 강수량 평균 |

매 수확기 이전의 기후 상태를 반영하기 위해 직전 비수확기 동안의 평균 강수량을 정적 변수로 저장하여 사용

### 🟦 사용 모델 - Attention - LSTM
- ARIMA, VAR, LSTM, Attention-LSTM 모델을 비교해보았을 때 가격의 변동성 반영을 가장 민감하게 반영하는 모델은 Attention-LSTM이므로 해당 모델을 선택
- Entmax를 사용하여 전체의 입력 중 모든 시점에 weight를 부여하지 않고 중요하게 생각하는 시점에만 weight를 부여해 핵심 구간에만 집중하게 만들 수 있음

- 모델 설계 요약도

| 구성요소        | 방식                    | 기능 및 목적                    |
| --------------- | ----------------------- | ----------------------- |
| 시계열 인코더  | LSTM| 순차 정보, 추세 학습  |
|Attention 메커니즘	|Entmax|	주요 시점 집중|
|Context 조합 방식	|Gated Fusion|context와 마지막 hidden을 가중 평균으로 유연하게 결합|
|예측 헤드|3-layer FC |	다양한 패턴 예측|
|Static Feature 사용|	Concatenation + FC |시계열 정보 외 정적 피처 보완 활용|
|Optimizer|	Adam	| 안정적 학습 |

### 🟦 예측 전략 및 목표
- 입력 시퀀스 당 14일 예측 / 7일 예측을 진행
- 두 예측 결과를 보안적으로 활용해 선제 대응 및 추세적인 상황 판단이 가능하도록 하는 것을 목표로 함

|모델|목적|역할|
|----|----|----|
|7일 예측 모델| 민감하게 반응하여 선제 대응|조기 경보 역할|
|14일 예측 모델| 지속 가능한 추세인지 확인 |추세 확정 역할|

### 🟦 14, 7일간 예측 모델별 결과 확인
![image](https://github.com/user-attachments/assets/8daa5896-dd8f-4b6f-812b-c6898c5c7711)
해당 문서의 [🟦 14일간의 예측 모델/🟦 7일간의 예측 모델](https://github.com/MJU-Capstone-2025/Coffee_Price_Prediction/blob/main/model_code/README.md) 참고

## 💡 모델 예측 결과를 통한 활용 전략
- 해당 문서의 [🟦 모델 예측 결과를 통한 활용 전략](https://github.com/MJU-Capstone-2025/Coffee_Price_Prediction/blob/main/model_code/README.md) 참고
- 모델의 예측 결과를 활용해 구매 시점 의사결정에 도움을 주기 위한 보조도구를 제안
- 구매 의사 결정 도구를 활용했을 때 수익률에 어떠한 영향을 주는지 확인하고 예측 결과만을 보고 판단하는 전략 1과 이를 조정한 전략 2의 검증 결과([🟦 모델 예측 결과를 통한 활용 전략 검증](https://github.com/MJU-Capstone-2025/Coffee_Price_Prediction/blob/main/model_code/README.md) )를 통해 실전 사용 전략을 세우고자 함
### ⭐ 전략 1. 생두 구매 타이밍 결정 보조도구
![image](https://github.com/user-attachments/assets/90b4b5f6-3d2e-4981-8594-5ef2b1fb8e3d)
### 🔍 전략 요약
- 최근 4일 예측 평균 대비 변화율을 통해 추세를 민감하게 탐지
- 단기(7일), 중기(14일) 예측을 함께 확인하여 신호의 확실성 확보
### ⭐ 전략 2. 예측 분기 감지 & 신뢰도 지표 이용한 구매 결정 보조도구
- 7일 예측과 14일 예측 간 예측 간 차이가 커서 해석이 엇갈릴 가능성 있음(예측 분기 감지)/Confidence가 낮음(산뢰도) >> 해당 경우에는 "Buy" 신호를 Caution으로 대체
![image](https://github.com/user-attachments/assets/7e5f635f-aa9e-4814-8fea-6188d8502815)
### 🔍 전략 요약
- 단기(7일)예측과 장기(14일)예측 결과의 방향성 일치 여부를 통해 예측 불일치 경고 감지
- 예측 간 차이가 임계값을 넘을 경우 사용자에게 주의 환기
- 두 지표를 병렬 활용하여 사용자는 단기 급변 신호와 모델의 예측 확신 정도를 모두 고려하여 구매 보조 도구 활용 가능
- 결과적으로 예측 신호를 반영한 구매 결정 보조도구, 예측 신호 + 신뢰 지표 + 분기 탐지를 함께고려한 구매 결정 보조도구를 통해 다층적 의사결정 가능

## ✅ 검증 결과를 통한 전략별 장단점
- 두 전략 모두 무작위로 구매했을 때의 평균 수익률은 0.42%였던 것에 비해 전략 1인 2.1%, 전략 2는 2.5%로 높게 나왔음
- 전략 2가 전략 1보다 더 보수적으로 접근하는 만큼 정밀도 0.7로 불필요한 Buy를 줄이고 더 정확한 Buy를 유지하는 경향이 있음
- 하지만 전략 2는 보수적으로 보기 때문에 Buy 기회를 제한하기 때문에 장기적인 수익률을 보았을 때는 전략 1이 더 높은 성과를 가짐

|전략|장점|단점|
|----|----|----|
|전략1|더 많은 매수 기회를 제공하여 장기적인 누적 수익률이 높음|잘못된 Buy를 포함할 가능성이 있어 잘못된 시점에 구매할 수 있음|
|전략2|예측 분기와 신뢰도 기준에 따라 불필요한 Buy를 필터링|매수 기회 제한되므로 장기 누적 수익률 낮아질 수 있음|

## ✅ 실전 적용 전략: 조건 기반의 상황별 병행 사용
|상황|추천 전략|이유|
|----|--------|----|
|시장이 불안정하거나 변동성이 큰 구간|전략 2|예측 분기/신뢰도 고려한 보수적 진입 필요|
|강한 상승장 혹은 선명한 추세가 존재할 때|전략 1|Buy 기회를 최대한 확보하여 수익 극대화|
|중소 도매업체, 재고 부담 큰 기업|전략 2|	잘못된 진입 회피가 중요 (보수적 접근 우선)|
|가격 민감하지 않고 자주 매입하는 소형 카페 등	|전략 1|기회 손실보다 진입 유연성 중요|

### 🟦 결론 요약
- 본 전략은 모델 기반의 예측 결과를 활용한 보조 지표이므로 시장 상황이나 비즈니스 의사결정을 전적으로 대체하기보다는 참고 자료로 활용
- 예측에는 변동성, 외부 요인, 공급망 변수 등이 영향을 줄 수 있으므로 결정을 위한 보조도구로 활용하는 것이 옳음
- 사용자가 단기 가격 하락을 기다리고 있을 때 전략 2를 사용하면 잘못된 시점에 대량 구매하는 것을 방지하는데 도움을 줄 수 있음
- 하지만 전략 2는 Buy 기회를 제한하기 때문에 장기 누적 수익률에서는 전략 1보다 낮은 성과를 보일 수 있으므로 상황에 따라 전략 1과 2를 병행해서 사용해야함
- 전략 1과 2는 상호 대체가 아닌, 상황 기반으로 선택적 병행될 수 있는 도구임
- 따라서 사용자는 시장 환경, 수요 예측, 내부 재고 상황 등을 고려하여 전략 2를 기본 전략으로 활용하되 기회가 뚜렷할 때는 전략 1을 병행하는 방식을 사용한다면 적절한 대량 구매 타이밍을 판단하는 데 도움이 되는 지표로 활용할 수 있음
