## Attention - LSTM 모델을 활용한 커피 가격 예측 모델
### 🟦 예측 전략 및 목표
- 입력 시퀀스 당 14일 예측 / 7일 예측을 진행함
- 두 예측 결과를 보안적으로 활용해 선제 대응 및 추세적인 상황 판단이 가능하도록 하는 것을 목표로 하였음

|모델|목적|역할|
|----|----|----|
|7일 예측 모델| 민감하게 반응하여 선제 대응|조기 경보 역할|
|14일 예측 모델| 지속 가능한 추세인지 확인 |추세 확정 역할|

### 🟦 14일간의 예측 모델
### 예측 결과 그래프

|test data 전 시점 그래프|최근 3달(2024.11.01~) 그래프|
|----|----|
|![image](https://github.com/user-attachments/assets/b1fd8097-b39c-4f8c-ad96-eed047645fa9)|![image](https://github.com/user-attachments/assets/3534c3fd-cb71-49a1-8b47-30d2bd975715)|

### 모델 성능 평가

|RMSE|MAE|
|----|----|
|12.9053|8.9388|

### 마지막 날로부터 14일간의 커피 가격 예측 포함
|예측값 표|그래프(2024.11.01~)|
|----|----|
|![image](https://github.com/user-attachments/assets/7f5438eb-a096-4819-8d26-2cc1f72cc32e)|![image](https://github.com/user-attachments/assets/c77c03f1-21a7-4e36-baf2-52b668e1e788)|


### 🟦 7일간의 예측 모델
### 예측 결과 그래프

|test data 전 시점 그래프|최근 3달(2024.11.01~) 그래프|
|----|----|
|![image](https://github.com/user-attachments/assets/cf349fdd-d6f0-4514-a155-440123a60880)|![image](https://github.com/user-attachments/assets/f1639af1-4e64-4a70-b0e9-b39855cde732)|

### 모델 성능 평가

|RMSE|MAE|
|----|----|
|9.1426|6.6435|

### 마지막 날로부터 14일간의 커피 가격 예측 포함
|예측값 표|그래프(2024.11.01~)|
|----|----|
|![image](https://github.com/user-attachments/assets/a9c55040-ae43-4f93-be3e-96a2ca735354)|![image](https://github.com/user-attachments/assets/d2190c96-7b24-45cb-b312-81c8589b856e)|

### 마지막 날로부터 7일간의 커피 가격 예측 포함
|예측값 표|그래프(2024.11.01~)|
|----|----|
|![image](https://github.com/user-attachments/assets/82663b27-6fa1-4406-b3c4-1d8d184e86b2)|![image](https://github.com/user-attachments/assets/0685e01e-879b-418c-97f5-1f8f0b0c4ea9)|

### 🟦 14일간 vs 7일간 결과 비교
### 차이 요약
| 항목      | 14일간 커피 가격 예측 모델   | 7일간 커피 가격 예측 모델  |
| --------------- | ----------------------- | ----------------------- |
|예측 기간|	한 번에 7일 예측	|한 번에 14일 예측|
|곡선 형태|	더 부드럽고 조심스러움|	더 공격적으로 추세 반영|
|추세|	단기 움직임을 더 잘 따라감|	장기 추세는 그리지만 세밀한 변화 반영 부족|
|미래 구간 불확실성|	예측 폭 좁고 안정적|	예측이 퍼질 가능성 있음|

### 사용 전략
1. 기본적으로 1주 예측 모델 사용
- 변동 예측이 안정적이고, 민감도 적절해 비즈니스 의사 결정에 더 알맞음
- 실제 변동에 근접한 패턴을 그림
2. 2주 예측 결과와 함께 병행해서 사용함
![image](https://github.com/user-attachments/assets/8daa5896-dd8f-4b6f-812b-c6898c5c7711)
- 결과의 추세가 일치하면 신뢰도 상승
- 추세가 다르면 미래 불확실성이 있음, 국면 전환 조짐으로 해석 가능

### 🟦 모델 예측 결과를 통한 활용 전략
- 모델 예측 결과를 가지고 구매 시점을 결정할 수 있는 보조도구를 제안
- 예측 결과만을 보고 판단하는 전략 1과 이를 조정한 전략 2의 검증 결과를 통해 최종 활용 전략을 결정하고자 함
### ⭐ 전략 1. 커피 가격 구매 타이밍 결정 보조도구
- 7일 예측 결과에서 최근 4일간의 평균 대비 현재 예측값이 +0.7% 이상 상승
- 14일 예측 결과에서도 최근 4일간의 평균 대비 현재 예측값이 +0.7% 이상 상승
- 두 조건을 모두 만족하면 상승 추세가 단기, 중기 모두 확인되었다고 판단하여 Buy 신호 발생

### 결과 해석
![image](https://github.com/user-attachments/assets/90b4b5f6-3d2e-4981-8594-5ef2b1fb8e3d)
### 🔍 전략 요약
- 최근 4일 예측 평균 대비 변화율을 통해 추세를 민감하게 탐지
- 단기(7일), 중기(14일) 예측을 함께 확인하여 신호의 확실성 확보

### 🔍 그래프 구성 설명
|항목|설명|
|----|----|
|파란 실선| 실제 커피 가격|
|빨간 점선| 7일간의 예측 모델 결과|
|주황 점선| 14일간의 예측 모델 결과|
|초록 삼각형| Buy 신호 — 가격이 상승할 것으로 예상되니 현재 시점에서 구매하는 것이 좋음|

### 🔍 결과 해석

|구간|전략 신호|실제 가격 흐름|
|----|--------|----|
|11월 중순|	Buy| 추후 가격 더 상승|
|2월 초~중순|	Buy|급등|

### ⭐ 전략 2. 예측 분기 감지 & 신뢰도 지표 이용한 구매 결정 보조도구
### 🟨 2-1. 예측 분기 감지
- 매 날짜별로 7일 예측값과 14일 예측값의 차이 확인
- 임계값은 차이가 최근 평균 가격(30일간)의 ±2%로 설정
- 임계값을 넘으면 예측 결과의 불확실성(예측 분기)이 있다고 판단
- 두 기간의 예측이 급격히 엇갈릴 때는 변동성 또는 불확실성 급증을 의미하므로 이 경우 사용자는 보수적 접근이 필요
### 결과 해석
![image](https://github.com/user-attachments/assets/a79f8fed-23cf-4d64-81c5-88f8cc383322)
### 🔍 전략 요약
- 두 예측 간 차이가 커질 때 예측 불일치 구간으로 판단
- 분기 신호는  확정된 매수/회피 판단이 아닌 보수적 접근 또는 판단 보류를 유도하는 경고성 보조 시그널
- 사용자가 판단하려는 시점이 임계값이 넘은 시점이라면 사용자는 예측 결과에 대해 보수적인 판단을 진행
### 🔍 그래프 구성 설명
|항목|방식|설명|의미|
|----|----|----|----|
|빨간 점선 (상단 임계선)|각 시점의 최근 30일간의 실제 커피 가격 평균 × +2%| 이 선 초과 시 단기 예측이 과도하게 높다고 판단| 과열 신호 (조심)|
|파란 점선 (하단 임계선)|각 시점의 최근 30일간의 실제 커피 가격 평균 × -2%|이 선 하회 시 단기 예측이 과도하게 낮다고 판단| 비관적 신호 (저평가 가능성)|
### 🔍 결과 해석

|구간|신호|의미|
|----|--------|----|
|2024년 12월/2025년 2월|예측간 차이 +10을 넘으며 단기 예측 과열 구간에 진입|단기 상승 낙관이 과도함|
|2025년 2월 말 ~ 3월|예측간 차이 -20까지 급락|과도한 낙폭 감지 구간|

### 🟨 2-2. 예측 신뢰도 지표
- 매 날짜별로 7일 예측값과 14일 예측값간의 일치 정도 확인
- 예측의 신뢰 가능성 및 확신 수준 정량
- 기준 값을 0.95로 설정하여 해당 기준보다 낮을 수록 예측 불안정성이 높다고 판단
### 결과 해석
![image](https://github.com/user-attachments/assets/b1ba11b7-626a-45f7-a780-a8758f2f352d)
### 🔍 전략 요약
- 예측의 일관성 검증 도구로 활용해 사용자가 리스크를 조절할 수 있도록 함
- 예측이 서로 유사할수록 모델의 방향성에 대한 확신이 높음
- 반대로 유사도가 낮으면 예측이 불안정하거나 경계적 흐름에 있다는 의미
### 🔍 그래프 구성 설명
|항목|의미|설명|
|----|----|----|
|초록색 선 (0.95 이상)|예측 일치|강한 확신|
|빨간색 선 (0.80 이하)|예측 불일치| 약한 확신|
|중간 영역 (0.8 ~ 0.95)|부분적 확신|
### 🔍 결과 해석

|구간|신호|의미|
|----|--------|----|
|대부분의 시점|초록색 선 넘음|7일간, 14일간의 예측이 거의 동일한 방향성을 가지고 있음|
|2024년 5월, 12월|초록색 선 넘지 못함|단기와 중기 예측이 엇갈릴 가능성이 있어 전략의 신중함 필요|

- 0.8 아래로 내려간 경우 없으므로 극단적인 예측 불일치는 거의 없음
- 모델 간 방향성은 비슷하다는 것을 보여줌.

### 🟨 2-3. 예측 분기 갑지 및 신뢰도 지표 이용하여 signal 변경
- 2-2 ,2-3의 결과를 이용하여 전략 1을 고도화
- 7일 예측과 14일 예측 간 예측 간 차이가 커서 해석이 엇갈릴 가능성 있음(2-1의 임계값 초과)/Confidence가 낮음(2-2 기준값 0.95를 넘지 못함) >> 해당 경우에는 "Buy" 신호를 Caution으로 대체
### 결과 해석
![image](https://github.com/user-attachments/assets/7e5f635f-aa9e-4814-8fea-6188d8502815)
### 🔍 전략 요약
- 단기(7일)예측과 장기(14일)예측 결과의 방향성 일치 여부를 통해 예측 불일치 경고 감지
- 예측 간 차이가 임계값을 넘을 경우 사용자에게 주의 환기
- 두 지표를 병렬 활용하여 사용자는 단기 급변 신호와 모델의 예측 확신 정도를 모두 고려하여 구매 보조 도구 활용 가능
- 결과적으로 예측 신호를 반영한 구매 결정 보조도구, 예측 신호 + 신뢰 지표 + 분기 탐지를 함께고려한 구매 결정 보조도구를 통해 다층적 의사결정 가능

### 🔍 그래프 구성 설명
|항목|설명|
|----|----|
|파란 실선| 실제 커피 가격|
|빨간 점선| 7일간의 예측 모델 결과|
|주황 점선| 14일간의 예측 모델 결과|
|초록 삼각형| Buy 신호 — 가격이 상승할 것으로 예상되니 현재 시점에서 구매하는 것이 좋음|
|파랑 원| Caution(divergence) - 단기/중기 예측 간 분기 존재하므로 방향성 판단에 유의해야함|
|주황 원| Caution(uncertainty) - 예측 신뢰도 부족으로 신호가 불안정하므로 신중한 판단 요구됨|

### 🔍 결과 해석

|구간|이전 신호|현재 신호|실제 가격 흐름|
|----|--------|----|----|
|2024년 11월| Buy | Caution(uncertainty) | 가격이 하락하려고 하기 전|

- 지표를 적용함으로써 기존에 명확한 시그널이 나왔던 구간에서도 Caution 신호가 나타날 수 있으므로 이는 오히려 예측에 대한 신중함을 더해주는 역할을 함
- 커피 가격 구매 타이밍 결정 보조도구와 예측 분기 감지 및 신뢰도 지표 기반의 보조 도구를 함께 고려함으로써 급격한 시장 전환이나 경계 구간에서 더 정교하고 신중한 구매 판단을 가능하게 함

### 🟦 모델 예측 결과를 통한 활용 전략 검증
### ⭐ 전략 목적 명확화
- 모델의 예측 결과를 활용해 구매 시점을 더 정밀하게 판단하고자 함
- 이 목표를 기준으로, 단순 Buy 전략(전략 1)과 조정된 Buy 전략(전략 2)을 비교하고 “정말 조정이 타당했는지”를 실증적으로 검증함
### ⭐ 1. Buy라고 판단한 시점에 구매했을 때 실제 수익에 긍정적 영향을 미치는가?
1. 평균 수익률 궤적 그래프
- Buy 신호가 발생한 시점 이후 일주일간 실제 가격이 평균적으로 어떻게 움직였는지를 시계열로 보여주는 그래프
![image](https://github.com/user-attachments/assets/1041e99e-a0fa-446b-966f-4a5103ee4877)
Buy 시그널 발생 후 평균 2일간 하락하지만 3일차부터 안정적인 우상향으로 전환
2. 누적 수익률 그래프
- Buy 신호가 발생한 시점에 매수하고 이를 일주일 보유했을 때의 누적 수익률이 어떻게 변하는지 시간 순서대로 시각화
![image](https://github.com/user-attachments/assets/d5cf9edb-6fd8-4827-8193-f1a0618725d3)
- 전체 기간 중 대체로 우상향으로 일관된 추세를 보여주는 누적 수익 곡선
- 완전한 우상향은 아니지만 장기적으로 유의미한 수익 확보
- 즉, 모델 신호가 실제로 작동하며 buy라고 뜬 시점에 구매를 반복한다면 장기적으로 보았을 때 수익이 누적되어 기하급수적으로 늘어날 수 있는 구조
### ⭐ 2. 단순 예측 기반 Buy(전략 1)보다 조정된 전략 2가 실제로 더 정밀한가?
- 전략 2는 예측 간 분기(7일 vs 14일 간 차이) 및 예측 신뢰도(confidence < 0.95)를 함께 고려하여 불확실하거나 방향성이 엇갈리는 구간에서는 Buy를 Caution으로 변경하도록 설계된 보수적 전략
- 검증을 위해 실제 가격 상승 구간에서 Buy를 추천했는가를 봄
- Buy 신호에 구매하는 것이 아닌 무작위로 구매하였을 때 평균 수익률은 0.42%임

|전략|precision|평균 수익률 (1주일 후)|
|----|----|----|
|전략 1|0.6|2.1%|
|전략 2|0.7|2.5%|
- 전략 1,2 모두 무작위로 구매했을 때 보다 일주일간의 수익률이 높게 나옴
- 전략 2가 정밀도가 0.7로 더 높음
- 전략 2가 전략1보다 더 보수적으로 접근하는 만큼 불필요한 Buy를 줄이고 더 정확한 Buy만 유지했음을 보여줌
### ⭐ 3. 전략 2에서 조정된 판단이 실제 매수 시점이 아니였는가?
1. buy에서 caution으로 변경한 시점의 실제 이후 가격 흐름
![image](https://github.com/user-attachments/assets/d9905a34-8749-4322-b1f2-ab99e6e72cbe)
- 2023년 9월 20일 전략 1은 단기 상승 신호로 인해 Buy 판단을 내렸지만 예측 분기 및 신뢰도 지표를 적용한 전략 2는 이 시점을 Caution으로 조정
- 실제 가격은 하락세를 보이며, 전략 2의 보수적 판단이 유효했음을 시각적으로 확인할 수 있음

2. 정밀도 확인

|변경 여부|precision|평균 수익률 (1주일 후)|
|----|----|----|
|Caution으로 변경됨|0.5|1.6%|
|그대로 Buy 유지|0.7|2.5%|
- Caution으로 변경된 것이 실제로 수익률 낮은 구간에 해당함
- 전략 2는 신호의 정확도를 높이기 위해 예측 분기 및 신뢰도 기준을 활용하여 잘못된 진입을 줄이며 실제로 Caution으로 변경된 시점의 평균 수익률이 낮았던 점에서 보수적 판단의 유효성 확인

### ⭐ 4. 보수적 접근을 하는 전략 2가 전략 1을 대신해도 되는가?
누적 수익률 그래프 확인
![image](https://github.com/user-attachments/assets/aa51680d-28f6-4f08-b079-0a6bc23cc0de)
- 전략 2는 보수적으로 보기 때문에 Buy 기회를 제한함으로써 장기 복리 누적 수익률에서는 전략 1이 더 높은 성과를 가짐

### ✅ 3,4 결과를 통한 정리

|전략|장점|단점|
|----|----|----|
|전략1|더 많은 매수 기회를 제공하여 장기적인 누적 수익률이 높음|잘못된 Buy를 포함할 가능성이 있어 잘못된 시점에 구매할 수 있음|
|전략2|예측 분기와 신뢰도 기준에 따라 불필요한 Buy를 필터링|매수 기회 제한되므로 장기 누적 수익률 낮아질 수 있음|

### ✅ 실전 적용 전략: 조건 기반의 상황별 병행 사용

|상황|추천 전략|이유|
|----|--------|----|
|시장이 불안정하거나 변동성이 큰 구간|전략 2|예측 분기/신뢰도 고려한 보수적 진입 필요|
|강한 상승장 혹은 선명한 추세가 존재할 때|전략 1|Buy 기회를 최대한 확보하여 수익 극대화|
|중소 도매업체, 재고 부담 큰 기업|전략 2|	잘못된 진입 회피가 중요 (보수적 접근 우선)|
|가격 민감하지 않고 자주 매입하는 소형 카페 등	|전략 1|기회 손실보다 진입 유연성 중요|

### 🟦 결론 요약
- 본 전략은 모델 기반의 예측 결과를 활용한 보조 지표이므로 시장 상황이나 비즈니스 의사결정을 전적으로 대체하기보다는 참고 자료로 활용
- 예측에는 변동성, 외부 요인, 공급망 변수 등이 영향을 줄 수 있으므로 결정을 위한 보조도구로 활용하는 것이 옳음
- 사용자가 단기 가격 하락을 기다리고 있을 때 전략 2를 사용하면 잘못된 시점에 대량 구매하는 것을 방지하는데 도움을 줄 수 있음
- 하지만 전략 2는 Buy 기회를 제한하기 때문에 장기 누적 수익률에서는 전략 1보다 낮은 성과를 보일 수 있으므로 상황에 따라 전략 1과 2를 병행해서 사용해야함
- 전략 1과 2는 상호 대체가 아닌, 상황 기반으로 선택적 병행될 수 있는 도구임
- 따라서 사용자는 시장 환경, 수요 예측, 내부 재고 상황 등을 고려하여 전략 2를 기본 전략으로 활용하되 기회가 뚜렷할 때는 전략 1을 병행하는 방식을 사용한다면 적절한 대량 구매 타이밍을 판단하는 데 도움이 되는 지표로 활용할 수 있음
