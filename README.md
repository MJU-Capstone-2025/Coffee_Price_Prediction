## 🟦 가격 예측 모델링 관련 진행상황
### 📘 데이터

#### 1. 거시경제 데이터
| 방식          | 처리       |
| --------------- | --------------- | 
| 스플라인 보간법 | 일간 데이터로 변경 |
| 보조피처 추가 | 커피 가격의 변동성 반영 |
- 추가 보조 피처 </br>

| 피처        | 생성 방법                    | 정보                    |
| --------------- | ----------------------- | ----------------------- |
| Abs_return  | 수익률의 절댓값 | 단기적 변화의 크기  |
| Abs_return  | n일간 수익률의 표준편차 | 변동성의 정도 측정  |
| Abs_return  | 5일전 가격 대비 현재 가격  | 상승세, 하락세 감지  |
| Abs_return  | 볼린저 밴드 폭 | 시장이 과열인지 안정인지 측정  |
| Abs_return  | z-score 계산 | 이상치, 비정상적인 변동 감지  |

#### 2 기후 데이터
| 방식        | 처리                    |
| --------------- | ----------------------- |
| 가장 최근 수확기의 평균값으로 정적피처 | LightGBM을 통한 feature selection 수행 |


### 📘 모델별 결과

#### ✅ VAR

- 예측/실제 비교 그래프
<img src = "https://github.com/user-attachments/assets/3dc404e0-bf5d-4738-ae43-81dccbb2af3f" width=900>

- 평가지표

| MAE | RMSE                    |
| ----- | ----------------------- |
| 8.6210  | 10.2275  |

VAR은 선형모델이기 때문에 급격한 비선형 변동에 민감하게 반응하지 못하고 있다.

#### ✅ LSTM
입력시점을 기준으로 14일간의 예측을 하기 위해 MultiStepLSTM으로 사용하였다.

- 예측/실제 비교 그래프
<img src = "https://github.com/user-attachments/assets/0ace463a-7b25-459a-8622-50a86e9144f5" width=900>

- 평가지표

| MAE | RMSE                    |
| ----- | ----------------------- |
| 5.1393  | 6.6995  |

급등/급락 부분에 대한 반영보단 완만한 예측을 하고 있다.

#### ✅ Attention - LSTM
일반 Attention은 softmax를 써서 모든 timestamp에 weight를 부과하기 때문에 평균화가 된다. <br> Entmax는 softmax의 대안으로 출력 벡터 중 일부 값은 0이 되도록 만든든 함수이다. 이를 통해 전체의 입력 중 모든 시점에 weight를 부여하지 않고 중요하게 생각하는 시점에만 weight를 부여해 핵심 구간에만 집중하게 만들 수 있다.
<br>
Softmax: 모든 입력에 양의 weight를 부여 → dense (모두 반영됨) <br>
Entmax: 중요하지 않은 입력에는 0을 출력함 → sparse (선택적 반영) <br>
따라서 Entmax를 사용하면 평탄화된 예측을 줄이고 변동성있는 예측을 반영할 수 있게 된다. 

- 모델 설계 요약도

| 구성요소        | 방식                    | 기능 및 목적                    |
| --------------- | ----------------------- | ----------------------- |
| 시계열 인코더  | LSTM| 순차 정보, 추세 학습  |
|Attention 메커니즘	|Entmax|	주요 시점 집중|
|Context 조합 방식	|Context + last hidden|	유연한 정보 선택|
|예측 헤드|	2-layer FC + ReLU|	다양한 패턴 예측|
|Optimizer|	Adam	| 안정적 학습 |

- 모델 구조 흐름 요약
<img src = "https://github.com/user-attachments/assets/3796dbae-8a90-4f89-8a81-886fa90e4545" width=350>

- 예측/실제 비교 그래프
<img src="https://github.com/user-attachments/assets/cac4eb39-2562-4741-9d05-161e7df5edbd" width=900>

- 평가지표

| MAE | RMSE |
| --- | ---- |
| 5.5794 | 6.8158 |

성능 평가 지표로 보았을 때는 MultiStepLSTM을 사용하였을 때보다 성능이 좋지 
못하다. 
<br>
하지만 예측 범위가 217 ~ 220 수준으로 평탄하였던 것에 비해 216 ~ 225로 폭이 
넓어졌다. 즉, 실제 값 방향성 반영이 더 잘 되고 있다. 
<br> 여전히 5월 26, 27일에 급등하는 부분에 덜 민감하게 따라간다. 모델이 스무딩 된 예측을 하는 경향이 여전히 있으므로 급등락 반영을 위한 손실함수의 수정을 통해 실제 추세를 더 잘 반영하도록 하는 수정이 필요하다.

## 🟦 고려해야할 사항
1. 기후데이터 사용 방법
- 현재는 가장 가까운 수확기의 평균값을 가지는 정적 피처로 사용하였다.
- 대표값을 가지는 것을 평균으로 할 지 아니면 다른 방식을 사용할지에 대한 고려가 필요하다.
2. Attention 모델
- 급등락 부분이 여전히 스무딩 되는 경향이 있다. 
- 변동성을 잘 학습할 수 있도록 입력 데이터 수정, 손실함수 수정, 예측값을 변동성으로 변경 등의 고려가 필요하다.
